<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Oog’s Majestic Cookie Vacuum</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffca28">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
/*  … (CSS unchanged from previous message) …  */
</style>
</head>

<body>
  <h1>👑 Oog’s Majestic Cookie Vacuum 👑</h1>
  <div id="hud">Score: 0 | Lives: 3</div>

  <div class="game-wrapper">
    <img src="bg.png" class="bg" alt="">
    <canvas id="game"></canvas>

    <!-- single vacuum button -->
    <button id="vacuum-btn">💨</button>
  </div>

  <button id="restart">Restart</button>

<script>
/* ===== responsive canvas ===== */
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
function fitCanvas(){
  const wrap=document.querySelector('.game-wrapper');
  const dpr=window.devicePixelRatio||1;
  canvas.width =wrap.clientWidth *dpr;
  canvas.height=wrap.clientHeight*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize',fitCanvas,{passive:true}); fitCanvas();

/* ===== DOM ===== */
const hud=document.getElementById('hud');
const restartB=document.getElementById('restart');
const vacuumBtn=document.getElementById('vacuum-btn');

/* ===== assets ===== */
const load=src=>{const im=new Image(); im.src=src; return im};
const princess=load('oog.png'), cookie=load('cookie.png'), arnoldImg=load('arnold.png');
const vacuumSound=new Audio('vacuum.wav'); vacuumSound.loop=true;
const loseSound  =new Audio('lose.m4a');

/* unlock iOS audio on first tap */
window.addEventListener('touchstart',()=>{new (window.AudioContext||window.webkitAudioContext)().resume();},{once:true});

/* ===== constants ===== */
const W=360, H=480;
/*  ✏️  fixed helpers  */
const sx = x => x * canvas.width  / W;
const sy = y => y * canvas.height / H;

/* ===== entities ===== */
const player={w:80,h:120,x:W/2-40,y:H-120,speed:5,movingLeft:false,movingRight:false,vacuumOn:false};
const arnold={active:false,x:-120,y:H-160,w:120,h:80,speed:0,timer:0};
function summonArnold(){
  if(arnold.active||!arnoldImg.complete) return;
  arnold.active=true; arnold.x=-arnold.w; arnold.y=H-160;
  arnold.speed=(W+arnold.w)/8000; arnold.timer=8000;
}

let score=0,lives=3,gameOver=false;
const cookies=[],particles=[];
let lastSpawn=0,lastTime=performance.now();

/* ===== particle class ===== */
class Particle{
  constructor(x,y){this.x=x;this.y=y;this.r=2+Math.random()*1.5;
    this.vx=(Math.random()*2-1)*.6; this.vy=-2-Math.random()*1.5; this.a=1;}
  update(dt){
    const dx=player.x+player.w/2-this.x,dy=player.y+player.h/2-this.y,d=Math.hypot(dx,dy)+.1,p=50/d;
    this.vx+=dx/d*p*dt*.001; this.vy+=dy/d*p*dt*.001;
    this.x+=this.vx*dt*.06; this.y+=this.vy*dt*.06; this.a-=dt/800;
    return this.a>0;
  }
  draw(){ctx.save();ctx.globalAlpha=Math.max(this.a,0);
    const g=ctx.createRadialGradient(sx(this.x),sy(this.y),0,sx(this.x),sy(this.y),sx(this.r*2));
    g.addColorStop(0,'rgba(255,255,255,.9)'); g.addColorStop(1,'rgba(173,216,230,0)');
    ctx.fillStyle=g;ctx.beginPath();ctx.arc(sx(this.x),sy(this.y),sx(this.r*2),0,Math.PI*2);ctx.fill();ctx.restore();}
}

/* ===== input: thumb zones + button ===== */
const key={};
function updateTouchDir(touches){
  let left=false,right=false; const mid=window.innerWidth/2;
  for(const t of touches){ if(t.clientX<mid) left=true; else right=true; }
  player.movingLeft=left; player.movingRight=right;
}
window.addEventListener('touchstart',e=>updateTouchDir(e.touches));
window.addEventListener('touchmove', e=>updateTouchDir(e.touches));
window.addEventListener('touchend',  e=>updateTouchDir(e.touches));

vacuumBtn.ontouchstart=()=>{if(!player.vacuumOn){vacuumSound.currentTime=0;vacuumSound.play();}player.vacuumOn=true;};
vacuumBtn.ontouchend  =()=>{player.vacuumOn=false; vacuumSound.pause(); vacuumSound.currentTime=0;};

document.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft') player.movingLeft=true;
  if(e.key==='ArrowRight')player.movingRight=true;
  if(e.key===' '){ if(!player.vacuumOn){vacuumSound.currentTime=0;vacuumSound.play();} player.vacuumOn=true;}
});
document.addEventListener('keyup',e=>{
  if(e.key==='ArrowLeft') player.movingLeft=false;
  if(e.key==='ArrowRight')player.movingRight=false;
  if(e.key===' '){player.vacuumOn=false; vacuumSound.pause(); vacuumSound.currentTime=0;}
});

/* ===== helpers ===== */
function spawnCookie(){const r=24; cookies.push({x:r+Math.random()*(W-2*r),y:-r,r,speed:2+Math.random()*2});}
function endGame(){gameOver=true;loseSound.play();hud.textContent=`Game Over! Final Score: ${score}`;restartB.style.display='block';}
restartB.onclick=()=>{Object.assign(player,{x:W/2-40}); cookies.length=particles.length=0;
  score=0;lives=3;gameOver=false;hud.textContent='Score: 0 | Lives: 3';restartB.style.display='none';};

/* ===== main loop ===== */
function loop(ts){
  const dt=ts-lastTime; lastTime=ts; if(gameOver){requestAnimationFrame(loop);return;}

  if(player.movingLeft) player.x=Math.max(0,player.x-player.speed);
  if(player.movingRight)player.x=Math.min(W-player.w,player.x+player.speed);

  if(arnold.active){arnold.x+=arnold.speed*dt; arnold.timer-=dt; if(arnold.timer<=0)arnold.active=false;}

  if(ts-lastSpawn>1200){spawnCookie(); lastSpawn=ts;}

  for(let i=cookies.length-1;i>=0;i--){
    const c=cookies[i]; c.y+=c.speed;
    const grabP=player.vacuumOn && c.y+c.r>player.y && c.y<player.y+player.h &&
                 Math.abs(c.x-(player.x+player.w/2))<40;
    const grabA=arnold.active && c.y+c.r>arnold.y && c.y<arnold.y+arnold.h &&
                 c.x>arnold.x && c.x<arnold.x+arnold.w;
    if(grabP||grabA){cookies.splice(i,1);score++; if(score%10===0) summonArnold(); continue;}
    if(c.y-c.r>H){cookies.splice(i,1); if(--lives<=0)return endGame();}
  }

  if(player.vacuumOn) for(let i=0;i<6;i++)
    particles.push(new Particle(player.x+player.w/2+(Math.random()*40-20),player.y+player.h/2+20));
  for(let i=particles.length-1;i>=0;i--) if(!particles[i].update(dt)) particles.splice(i,1);

  ctx.clearRect(0,0,canvas.width,canvas.height);
  cookies.forEach(c=>cookie.complete&&ctx.drawImage(cookie,sx(c.x-c.r),sy(c.y-c.r),sx(c.r*2),sy(c.r*2)));
  particles.forEach(p=>p.draw());
  princess.complete&&ctx.drawImage(princess,sx(player.x),sy(player.y),sx(player.w),sy(player.h));
  arnold.active&&arnoldImg.complete&&ctx.drawImage(arnoldImg,sx(arnold.x),sy(arnold.y),sx(arnold.w),sy(arnold.h));
  if(player.vacuumOn){ctx.fillStyle='rgba(255,255,255,.1)';
    ctx.fillRect(sx(player.x+player.w/2-40),sy(player.y-220),sx(80),sy(220));}
  hud.textContent=`Score: ${score} | Lives: ${lives}`;
  requestAnimationFrame(loop);
}

/* start */
Promise.all([princess.decode(),cookie.decode(),arnoldImg.decode()])
  .then(()=>requestAnimationFrame(loop));

/* PWA SW */
'serviceWorker' in navigator && navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>
