<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Oog’s Majestic Cookie Vacuum</title>

<style>
/* ——— Global ——— */
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
html,body{touch-action:none;-webkit-user-select:none;-webkit-touch-callout:none;overscroll-behavior:none;}
body{display:flex;flex-direction:column;align-items:center;color:#fff;padding-top:env(safe-area-inset-top)}

/* ——— Header & HUD ——— */
h1{margin:20px 0 10px;font-size:2rem;text-align:center;background:rgba(0,0,0,.55);padding:8px 16px;border-radius:8px}
#hud{font-size:1.2rem;margin-bottom:8px;background:rgba(0,0,0,.55);padding:6px 12px;border-radius:6px}

/* ——— Game wrapper ——— */
.game-wrapper{position:relative;width:100%;max-width:480px;aspect-ratio:3/4;box-shadow:0 4px 24px rgba(0,0,0,.18);overflow:hidden}
.bg{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;pointer-events:none}
canvas{position:relative;z-index:1;width:100%;height:100%;border:4px solid #ffca28;background:transparent;touch-action:manipulation}

/* ——— Restart ——— */
#restart{display:none;margin:16px 0;padding:12px 24px;font-size:1rem;background:#ffca28;border:none;border-radius:6px;cursor:pointer}
#restart:hover{opacity:.85}

/* ——— Mobile control bar ——— */
#mobile-controls{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:24px;z-index:2;pointer-events:none}
#mobile-controls button{width:56px;height:56px;font-size:1.8rem;pointer-events:auto;background:rgba(255,202,40,.9);color:#fff;border:none;border-radius:50%;backdrop-filter:blur(4px)}
@media (hover:hover) and (pointer:fine){#mobile-controls{display:none}}
</style>
</head>

<body>
  <h1>👑 Oog’s Majestic Cookie Vacuum 👑</h1>
  <div id="hud">Score: 0 | Lives: 3</div>

  <div class="game-wrapper">
    <img src="bg.png" class="bg" alt="">
    <canvas id="game" width="360" height="480"></canvas>

    <!-- Mobile controls -->
    <div id="mobile-controls">
      <button id="left-btn">◀️</button>
      <button id="vacuum-btn">💨</button>
      <button id="right-btn">▶️</button>
    </div>
  </div>

  <button id="restart">Restart</button>

<script>
/* ===== Prevent page scroll ===== */
document.body.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});

/* ===== Canvas & context ===== */
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');

/* ===== DOM ===== */
const hud=document.getElementById('hud'), restartB=document.getElementById('restart');
const leftBtn=document.getElementById('left-btn'), rightBtn=document.getElementById('right-btn'), vacuumBtn=document.getElementById('vacuum-btn');

/* ===== Assets ===== */
const princessImg=new Image(); princessImg.src='oog.png';
const cookieImg  =new Image(); cookieImg.src ='cookie.png';
const arnoldImg  =new Image(); arnoldImg.src ='arnold.png';
const vacuumSound=new Audio('vacuum.wav'); vacuumSound.loop=true;
const loseSound  =new Audio('lose.m4a');

/* ===== Player ===== */
const player={w:80,h:120,x:canvas.width/2-40,y:canvas.height-120,speed:5,movingLeft:false,movingRight:false,vacuumOn:false};

/* ===== Arnold helper ===== */
const arnold={active:false,x:-120,y:canvas.height-160,w:120,h:80,speed:0,timer:0};
function summonArnold(){
  if(arnold.active||!arnoldImg.complete) return;            // ignore if already on screen
  arnold.active=true;
  arnold.x=-arnold.w;
  arnold.y=canvas.height-160;
  arnold.speed=(canvas.width+arnold.w)/8000;  // cross in 8 s
  arnold.timer=8000;
}

/* ===== Game state ===== */
let score=0,lives=3,gameOver=false;
const cookies=[],particles=[];
let lastCookie=0,lastTime=performance.now();

/* ===== Particle class ===== */
class Particle{
  constructor(x,y){this.x=x;this.y=y;this.vx=(Math.random()*2-1)*.6;this.vy=-2-Math.random()*1.5;this.r=2+Math.random()*1.5;this.life=0;this.a=1;}
  update(dt){const dx=player.x+player.w/2-this.x,dy=player.y+player.h/2-this.y,dist=Math.hypot(dx,dy)+.1,pull=50/dist;
    this.vx+=dx/dist*pull*dt*.001; this.vy+=dy/dist*pull*dt*.001;
    this.x+=this.vx*dt*.06; this.y+=this.vy*dt*.06; this.life+=dt; this.a=Math.max(0,1-this.life/800);}
  draw(){ctx.save();ctx.globalAlpha=this.a;const g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.r*2);
    g.addColorStop(0,'rgba(255,255,255,.9)');g.addColorStop(1,'rgba(173,216,230,0)');
    ctx.fillStyle=g;ctx.beginPath();ctx.arc(this.x,this.y,this.r*2,0,Math.PI*2);ctx.fill();ctx.restore();}
}

/* ===== Controls — keyboard ===== */
document.addEventListener('keydown',e=>{
  if(['ArrowLeft','ArrowRight'].includes(e.code))e.preventDefault();
  if(e.code==='ArrowLeft')player.movingLeft=true;
  if(e.code==='ArrowRight')player.movingRight=true;
  if(e.code==='Space'){if(!player.vacuumOn){vacuumSound.currentTime=0;vacuumSound.play();} player.vacuumOn=true;}
});
document.addEventListener('keyup',e=>{
  if(e.code==='ArrowLeft')player.movingLeft=false;
  if(e.code==='ArrowRight')player.movingRight=false;
  if(e.code==='Space'){player.vacuumOn=false;vacuumSound.pause();vacuumSound.currentTime=0;}
});

/* ===== Controls — touch ===== */
leftBtn.ontouchstart =()=>player.movingLeft=true;  leftBtn.ontouchend =()=>player.movingLeft=false;
rightBtn.ontouchstart=()=>player.movingRight=true; rightBtn.ontouchend=()=>player.movingRight=false;
vacuumBtn.ontouchstart=()=>{if(!player.vacuumOn){vacuumSound.currentTime=0;vacuumSound.play();} player.vacuumOn=true;};
vacuumBtn.ontouchend  =()=>{player.vacuumOn=false;vacuumSound.pause();vacuumSound.currentTime=0;};

/* ===== Voice control ===== */
const SpeechRec=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SpeechRec){
  const rec=new SpeechRec();rec.lang='he-IL';rec.continuous=true;
  rec.onresult=e=>{
    const txt=e.results[e.results.length-1][0].transcript.toLowerCase();
    if(txt.includes('arnold') || txt.includes('ארנולד')) summonArnold();
  };
  rec.onend=()=>rec.start(); rec.onerror=()=>rec.start(); rec.start();
}

/* ===== Helpers ===== */
function spawnCookie(){const r=24; cookies.push({x:r+Math.random()*(canvas.width-2*r),y:-r,r,speed:2+Math.random()*2});}
function endGame(){gameOver=true;loseSound.play();hud.textContent=`Game Over! Final Score: ${score}`;restartB.style.display='block';}
restartB.onclick=()=>{cookies.length=0;particles.length=0;score=0;lives=3;gameOver=false;
  hud.textContent='Score: 0 | Lives: 3';restartB.style.display='none';
  lastTime=performance.now();requestAnimationFrame(loop);};

/* ===== Main loop ===== */
function loop(ts){
  if(gameOver)return;
  const dt=ts-lastTime; lastTime=ts;

  /* Player movement */
  if(player.movingLeft) player.x=Math.max(0,player.x-player.speed);
  if(player.movingRight)player.x=Math.min(canvas.width-player.w,player.x+player.speed);

  /* Arnold movement */
  if(arnold.active){arnold.x+=arnold.speed*dt; arnold.timer-=dt; if(arnold.timer<=0)arnold.active=false;}

  /* Cookie spawn */
  if(ts-lastCookie>1200){spawnCookie(); lastCookie=ts;}

  /* Update cookies */
  for(let i=cookies.length-1;i>=0;i--){
    const c=cookies[i]; c.y+=c.speed;
    /* Vacuum collisions */
    const playerGrab = player.vacuumOn && c.y+c.r>player.y && c.y<player.y+player.h && Math.abs(c.x-(player.x+player.w/2))<40;
    const arnoldGrab = arnold.active && c.y+c.r>arnold.y && c.y<arnold.y+arnold.h && c.x>arnold.x && c.x<arnold.x+arnold.w;
    if(playerGrab || arnoldGrab){
      cookies.splice(i,1); score++;
      /* New feature: summon Arnold on each multiple of 10 */
      if(score%10===0) summonArnold();
      continue;
    }
    /* Missed cookie */
    if(c.y-c.r>canvas.height){cookies.splice(i,1);if(--lives<=0)return endGame();}
  }

  /* Particle spawn */
  if(player.vacuumOn)for(let i=0;i<6;i++)particles.push(new Particle(player.x+player.w/2+(Math.random()*40-20),player.y+player.h/2+20));
  /* Update particles */
  particles.forEach((p,i)=>{p.update(dt); if(p.a<=0)particles.splice(i,1);});

  /* Draw */
  ctx.clearRect(0,0,canvas.width,canvas.height);
  cookies.forEach(c=>{if(cookieImg.complete)ctx.drawImage(cookieImg,c.x-c.r,c.y-c.r,c.r*2,c.r*2);});
  particles.forEach(p=>p.draw());
  princessImg.complete&&ctx.drawImage(princessImg,player.x,player.y,player.w,player.h);
  arnold.active&&arnoldImg.complete&&ctx.drawImage(arnoldImg,arnold.x,arnold.y,arnold.w,arnold.h);
  if(player.vacuumOn){ctx.fillStyle='rgba(255,255,255,.1)';ctx.fillRect(player.x+player.w/2-40,player.y-220,80,220);}
  hud.textContent=`Score: ${score} | Lives: ${lives}`;
  requestAnimationFrame(loop);
}

/* ===== Start game ===== */
Promise.all([princessImg.decode(),cookieImg.decode(),arnoldImg.decode()])
  .finally(()=>requestAnimationFrame(loop));
</script>
</body>
</html>
